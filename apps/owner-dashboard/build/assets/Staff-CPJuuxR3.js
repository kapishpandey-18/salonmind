import{r,j as e,t as l}from"./index-_T_dclBo.js";import{C as o,a as d,b as ae,c as te,e as ne}from"./card-mM-adsMl.js";import{D as L,a as z,b as F,c as O,d as V}from"./dialog-R0K7NxxJ.js";import{I as m}from"./input-BvLdwGAG.js";import{L as x}from"./label-DvinGlq6.js";import{U as ie,b as le,B as h,c as re,d as ce,e as oe,f as de,g as p}from"./ownerService-CJxlrD2e.js";import{S as me}from"./switch-CDDxG62m.js";import{E as H,S as P}from"./EmptyState-CZE-0j11.js";import{u as xe,E as he,a as fe,P as ue,C as je}from"./useDebouncedValue-tealXdGx.js";import{u as ge,a as pe}from"./useStaff-DIArrfxW.js";import{U as ve}from"./user-check-Be86tNXl.js";import{c as Ne}from"./createLucideIcon-vxqge8nX.js";import{S as ye}from"./star-BwUZsI9g.js";import{S as be}from"./search-1uIckXng.js";import{P as Se}from"./phone-D-xVqN8g.js";import{T as we}from"./trash-2-DIkBWH60.js";import"./index-BHur5ELe.js";import"./Dashboard-vSO5UD5A.js";const Ce=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],Pe=Ne("user-x",Ce),$={name:"",role:"",email:"",phone:"",notes:"",isActive:!0,compensation:{monthlySalary:0,commissionPercent:0}};function Xe({activeBranchId:f,onOpenDetails:A}){const[q,g]=r.useState(!1),[X,k]=r.useState(!1),[E,Y]=r.useState(""),[G,y]=r.useState(1),[n,i]=r.useState($),[t,b]=r.useState(null),D=xe(E),J=8;r.useEffect(()=>{y(1)},[D,f]);const{data:M,isLoading:K}=ge({branchId:f,search:D,page:G,limit:J}),u=M?.items??[],c=M?.pagination,{create:R,update:T,updateStatus:S,remove:w}=pe(f),U=R.isPending||T.isPending||S.isPending||w.isPending,_=()=>{b(null),i($),g(!0)},Q=s=>{b(s),i({name:s.name||"",role:s.role||"",email:s.email||"",phone:s.phone||"",notes:s.notes||"",isActive:s.isActive??s.status!=="off",compensation:{monthlySalary:s.compensation?.monthlySalary??0,commissionPercent:s.compensation?.commissionPercent??0}}),g(!0)},I=s=>{b(s),k(!0)},W=s=>{if(A){A(s._id);return}I(s)},Z=async()=>{if(!n.name){l.error("Name is required");return}try{t?(await T.mutateAsync({id:t._id,data:n}),l.success("Staff updated")):(await R.mutateAsync({...n,branchId:f||void 0}),l.success("Staff created")),g(!1)}catch(s){if(s?.statusCode===403&&s?.code==="PLAN_LIMIT_EXCEEDED"){const a=typeof s?.meta?.limit=="number"?s.meta.limit:null,j=a!==null?`Your current plan allows up to ${a} staff members. Upgrade your plan or purchase an add-on to add more.`:s?.message||"Unable to save staff member",N=a!==null&&s?.meta?.upgradeHint?"Add extra staff for ₹99":null;l.error(N?`${j}
${N}`:j);return}l.error(s?.message||"Unable to save staff member")}},B=async s=>{try{await w.mutateAsync(s),l.success("Staff removed")}catch(a){l.error(a?.message||"Unable to remove staff member")}},ee=async(s,a)=>{try{await S.mutateAsync({id:s._id,isActive:a}),l.success(`Staff ${a?"enabled":"disabled"}`)}catch(j){l.error(j?.message||"Unable to update status")}},v=r.useMemo(()=>{const s=c?.total??u.length,a=u.filter(C=>C.isActive!==!1).length,j=s-a,N=s>0?u.reduce((C,se)=>C+(Number(se.rating)||0),0)/s:0;return{total:s,active:a,inactive:j,avgRating:N.toFixed(1)}},[u,c?.total]);return f?e.jsxs("div",{className:"space-y-6",children:[e.jsx(he,{title:"Staff Management",description:"Search, create, and manage staff for the selected branch.",onCreate:_,createLabel:"Add Staff",isCreateDisabled:!f}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsx(o,{className:"border-l-4 border-l-purple-500 hover:shadow-lg transition-shadow",children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Total Members"}),e.jsx("div",{className:"text-2xl text-foreground mb-1",children:v.total})]}),e.jsx("div",{className:"shrink-0 w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx(ie,{className:"w-5 h-5 text-purple-600"})})]})})}),e.jsx(o,{className:"border-l-4 border-l-green-500 hover:shadow-lg transition-shadow",children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Active"}),e.jsx("div",{className:"text-2xl text-foreground mb-1",children:v.active})]}),e.jsx("div",{className:"shrink-0 w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(ve,{className:"w-5 h-5 text-green-600"})})]})})}),e.jsx(o,{className:"border-l-4 border-l-red-500 hover:shadow-lg transition-shadow",children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Inactive"}),e.jsx("div",{className:"text-2xl text-foreground mb-1",children:v.inactive})]}),e.jsx("div",{className:"shrink-0 w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(Pe,{className:"w-5 h-5 text-red-600"})})]})})}),e.jsx(o,{className:"border-l-4 border-l-amber-500 hover:shadow-lg transition-shadow",children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Avg. Rating"}),e.jsx("div",{className:"text-2xl text-foreground mb-1",children:v.avgRating})]}),e.jsx("div",{className:"shrink-0 w-10 h-10 bg-amber-100 rounded-full flex items-center justify-center",children:e.jsx(ye,{className:"w-5 h-5 text-amber-600"})})]})})})]}),e.jsx(o,{className:"bg-card border-border",children:e.jsx(d,{className:"pt-6",children:e.jsx("div",{className:"flex flex-col md:flex-row gap-4",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(be,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(m,{placeholder:"Search staff...",value:E,onChange:s=>Y(s.target.value),className:"pl-10 bg-input-background border-border"})]})})})}),K?e.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:Array.from({length:6}).map((s,a)=>e.jsx(o,{children:e.jsxs(d,{className:"space-y-3 py-6",children:[e.jsx(P,{className:"h-6 w-32"}),e.jsx(P,{className:"h-4 w-48"}),e.jsx(P,{className:"h-4 w-20"})]})},a))}):u.length===0?e.jsx(H,{title:"No staff yet",description:"Add your first team member to get started.",actionLabel:"Add staff",onAction:_}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:u.map(s=>e.jsxs(o,{onDoubleClick:()=>I(s),children:[e.jsxs(ae,{className:"flex flex-row items-center justify-between space-y-0",children:[e.jsx(te,{children:s.name}),e.jsx(le,{variant:s.isActive?"default":"secondary",children:s.role||"Team"})]}),e.jsxs(d,{className:"space-y-3 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-4 w-4"}),s.phone||"—"]}),e.jsxs("div",{children:["Rating: ",s.rating??"—"]}),e.jsxs("div",{children:["Notes: ",s.notes||"—"]})]}),e.jsxs(ne,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{checked:s.isActive!==!1,onCheckedChange:a=>ee(s,a),disabled:S.isPending}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.isActive!==!1?"Active":"Disabled"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{size:"icon",variant:"ghost",onClick:()=>W(s),children:e.jsx(fe,{className:"h-4 w-4"})}),e.jsx(h,{size:"icon",variant:"ghost",onClick:()=>Q(s),children:e.jsx(ue,{className:"h-4 w-4"})}),e.jsx(je,{title:"Remove staff",description:"This will hide the staff member from this branch.",onConfirm:()=>B(s._id),trigger:e.jsx(h,{size:"icon",variant:"ghost",children:e.jsx(we,{className:"h-4 w-4"})}),disabled:w.isPending})]})]})]},s._id))}),c&&e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[e.jsxs("div",{children:["Page ",c.page," of ",c.totalPages]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx(h,{variant:"outline",size:"sm",onClick:()=>y(s=>Math.max(s-1,1)),disabled:!c.hasPrev,children:"Previous"}),e.jsx(h,{variant:"outline",size:"sm",onClick:()=>y(s=>s+1),disabled:!c.hasNext,children:"Next"})]})]}),e.jsx(L,{open:q,onOpenChange:g,children:e.jsxs(z,{className:"max-w-lg",children:[e.jsxs(F,{children:[e.jsx(O,{children:t?"Edit Staff":"Add Staff"}),e.jsx(V,{className:"sr-only",children:t?"Update staff member details.":"Enter staff member details."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Name"}),e.jsx(m,{value:n.name,onChange:s=>i(a=>({...a,name:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Role"}),e.jsx(m,{value:n.role,onChange:s=>i(a=>({...a,role:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Email"}),e.jsx(m,{type:"email",value:n.email,onChange:s=>i(a=>({...a,email:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Phone"}),e.jsx(m,{value:n.phone,onChange:s=>i(a=>({...a,phone:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Monthly Salary"}),e.jsx(m,{type:"number",min:0,value:n.compensation.monthlySalary,onChange:s=>i(a=>({...a,compensation:{...a.compensation,monthlySalary:Number(s.target.value)}}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Commission"}),e.jsxs(re,{value:String(n.compensation.commissionPercent),onValueChange:s=>i(a=>({...a,compensation:{...a.compensation,commissionPercent:Number(s)}})),children:[e.jsx(ce,{children:e.jsx(oe,{placeholder:"Select commission"})}),e.jsxs(de,{children:[e.jsx(p,{value:"0",children:"0%"}),e.jsx(p,{value:"5",children:"5%"}),e.jsx(p,{value:"10",children:"10%"}),e.jsx(p,{value:"15",children:"15%"}),e.jsx(p,{value:"20",children:"20%"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Notes"}),e.jsx(m,{value:n.notes,onChange:s=>i(a=>({...a,notes:s.target.value}))})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(h,{variant:"outline",onClick:()=>g(!1),disabled:U,children:"Cancel"}),e.jsx(h,{onClick:Z,disabled:U,children:"Save"})]})]})}),e.jsx(L,{open:X,onOpenChange:k,children:e.jsxs(z,{children:[e.jsxs(F,{children:[e.jsx(O,{children:t?.name}),e.jsx(V,{className:"sr-only",children:"Review staff member details."})]}),e.jsxs("div",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsxs("div",{children:["Role: ",t?.role||"—"]}),e.jsxs("div",{children:["Email: ",t?.email||"—"]}),e.jsxs("div",{children:["Phone: ",t?.phone||"—"]}),e.jsxs("div",{children:["Notes: ",t?.notes||"—"]}),e.jsxs("div",{children:["Monthly Salary:"," ",t?.compensation?.monthlySalary??0]}),e.jsxs("div",{children:["Commission:"," ",t?.compensation?.commissionPercent??0,"%"]})]})]})})]}):e.jsx(H,{title:"Select a branch",description:"Choose a branch to manage its staff."})}export{Xe as default};
