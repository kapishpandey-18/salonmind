import{r,j as e,t as h}from"./index-_T_dclBo.js";import{C as d,a as o,b as Z,c as B,e as ee}from"./card-mM-adsMl.js";import{D as M,a as T,b as _,c as U,d as L}from"./dialog-R0K7NxxJ.js";import{I as u}from"./input-BvLdwGAG.js";import{L as p}from"./label-DvinGlq6.js";import{U as se,b as O,B as m}from"./ownerService-CJxlrD2e.js";import{E as z,S as F}from"./EmptyState-CZE-0j11.js";import{u as ae,E as te,a as le,P as re,C as ie}from"./useDebouncedValue-tealXdGx.js";import{u as ne,a as ce}from"./useClients-sGFMukDF.js";import{U as de}from"./user-check-Be86tNXl.js";import{S as oe}from"./star-BwUZsI9g.js";import{c as H}from"./createLucideIcon-vxqge8nX.js";import{S as me}from"./search-1uIckXng.js";import{P as xe}from"./phone-D-xVqN8g.js";import{M as he}from"./mail-BiSpYR7m.js";import{T as ue}from"./trash-2-DIkBWH60.js";import"./index-BHur5ELe.js";import"./Dashboard-vSO5UD5A.js";const je=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],ge=H("tag",je);const pe=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],fe=H("user-plus",pe),I={fullName:"",phoneNumber:"",email:"",notes:"",tags:[]};function ze({activeBranchId:x}){const[V,j]=r.useState(!1),[q,w]=r.useState(!1),[C,R]=r.useState(""),[$,N]=r.useState(1),[l,i]=r.useState(I),[t,v]=r.useState(null),k=ae(C),G=8;r.useEffect(()=>{N(1)},[k,x]);const{data:S,isLoading:J}=ne({branchId:x,search:k,page:$,limit:G}),n=S?.items??[],c=S?.pagination,{create:P,update:A,remove:b}=ce(x),E=P.isPending||A.isPending||b.isPending,f=r.useMemo(()=>{const s=c?.total??n.length,a=n.filter(g=>g.status!=="inactive").length,y=n.filter(g=>g.status==="vip").length,Y=n.filter(g=>g.status==="new").length;return{total:s,active:a,vip:y,recent:Y}},[n,c?.total]),D=()=>{v(null),i(I),j(!0)},K=s=>{v(s),i({fullName:s.fullName,phoneNumber:s.phoneNumber,email:s.email||"",notes:s.notes||"",tags:s.tags||[]}),j(!0)},Q=s=>{v(s),w(!0)},W=async()=>{if(!l.fullName||!l.phoneNumber){h.error("Name and phone number are required");return}try{t?(await A.mutateAsync({id:t._id,data:l}),h.success("Client updated")):(await P.mutateAsync({...l,branchId:x||void 0}),h.success("Client created")),j(!1)}catch(s){h.error(s?.message||"Unable to save client")}},X=async s=>{try{await b.mutateAsync(s),h.success("Client deleted")}catch(a){h.error(a?.message||"Unable to delete client")}};return x?e.jsxs("div",{className:"space-y-6",children:[e.jsx(te,{title:"Clients",description:"Manage salon clients and their contact information.",onCreate:D,createLabel:"Add Client",isCreateDisabled:!x}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsx(d,{className:"border-l-4 border-l-purple-500 hover:shadow-lg transition-shadow",children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Total Clients"}),e.jsx("div",{className:"text-2xl text-foreground mb-1",children:f.total})]}),e.jsx("div",{className:"shrink-0 w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx(se,{className:"w-5 h-5 text-purple-600"})})]})})}),e.jsx(d,{className:"border-l-4 border-l-green-500 hover:shadow-lg transition-shadow",children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Active"}),e.jsx("div",{className:"text-2xl text-foreground mb-1",children:f.active})]}),e.jsx("div",{className:"shrink-0 w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(de,{className:"w-5 h-5 text-green-600"})})]})})}),e.jsx(d,{className:"border-l-4 border-l-amber-500 hover:shadow-lg transition-shadow",children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"VIP"}),e.jsx("div",{className:"text-2xl text-foreground mb-1",children:f.vip})]}),e.jsx("div",{className:"shrink-0 w-10 h-10 bg-amber-100 rounded-full flex items-center justify-center",children:e.jsx(oe,{className:"w-5 h-5 text-amber-600"})})]})})}),e.jsx(d,{className:"border-l-4 border-l-blue-500 hover:shadow-lg transition-shadow",children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"New"}),e.jsx("div",{className:"text-2xl text-foreground mb-1",children:f.recent})]}),e.jsx("div",{className:"shrink-0 w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(fe,{className:"w-5 h-5 text-blue-600"})})]})})})]}),e.jsx(d,{className:"bg-card border-border",children:e.jsx(o,{className:"pt-6",children:e.jsx("div",{className:"flex flex-col md:flex-row gap-4",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(me,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(u,{placeholder:"Search clients...",value:C,onChange:s=>R(s.target.value),className:"pl-10 bg-input-background border-border"})]})})})}),J?e.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:Array.from({length:6}).map((s,a)=>e.jsx(d,{children:e.jsxs(o,{className:"space-y-3 py-6",children:[e.jsx(F,{className:"h-6 w-32"}),e.jsx(F,{className:"h-4 w-48"})]})},a))}):n.length===0?e.jsx(z,{title:"No clients yet",description:"Add clients as they complete onboarding.",actionLabel:"Add client",onAction:D}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:n.map(s=>e.jsxs(d,{children:[e.jsxs(Z,{className:"flex flex-row items-center justify-between space-y-0",children:[e.jsx(B,{children:s.fullName}),e.jsx(O,{children:s.status||"active"})]}),e.jsxs(o,{className:"space-y-3 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-4 w-4"}),s.phoneNumber]}),s.email&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-4 w-4"}),s.email]}),s.tags&&s.tags.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.tags.map(a=>e.jsx(O,{variant:"secondary",children:a},a))})]})]}),e.jsxs(ee,{className:"flex items-center justify-end gap-2",children:[e.jsx(m,{size:"icon",variant:"ghost",onClick:()=>Q(s),children:e.jsx(le,{className:"h-4 w-4"})}),e.jsx(m,{size:"icon",variant:"ghost",onClick:()=>K(s),children:e.jsx(re,{className:"h-4 w-4"})}),e.jsx(ie,{title:"Delete client",description:"This action archives the client for this tenant.",onConfirm:()=>X(s._id),trigger:e.jsx(m,{size:"icon",variant:"ghost",children:e.jsx(ue,{className:"h-4 w-4"})}),disabled:b.isPending})]})]},s._id))}),c&&e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[e.jsxs("div",{children:["Page ",c.page," of ",c.totalPages]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:()=>N(s=>Math.max(s-1,1)),disabled:!c.hasPrev,children:"Previous"}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>N(s=>s+1),disabled:!c.hasNext,children:"Next"})]})]}),e.jsx(M,{open:V,onOpenChange:j,children:e.jsxs(T,{className:"max-w-lg",children:[e.jsxs(_,{children:[e.jsx(U,{children:t?"Edit Client":"Add Client"}),e.jsx(L,{className:"sr-only",children:t?"Update client details.":"Enter client details."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Full name"}),e.jsx(u,{value:l.fullName,onChange:s=>i(a=>({...a,fullName:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Phone number"}),e.jsx(u,{value:l.phoneNumber,onChange:s=>i(a=>({...a,phoneNumber:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Email"}),e.jsx(u,{type:"email",value:l.email,onChange:s=>i(a=>({...a,email:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Tags (comma separated)"}),e.jsx(u,{value:l.tags.join(", "),onChange:s=>i(a=>({...a,tags:s.target.value.split(",").map(y=>y.trim()).filter(Boolean)}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Notes"}),e.jsx(u,{value:l.notes,onChange:s=>i(a=>({...a,notes:s.target.value}))})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(m,{variant:"outline",onClick:()=>j(!1),disabled:E,children:"Cancel"}),e.jsx(m,{onClick:W,disabled:E,children:"Save"})]})]})}),e.jsx(M,{open:q,onOpenChange:w,children:e.jsxs(T,{children:[e.jsxs(_,{children:[e.jsx(U,{children:t?.fullName}),e.jsx(L,{className:"sr-only",children:"Review client details."})]}),e.jsxs("div",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsxs("div",{children:["Phone: ",t?.phoneNumber||"—"]}),e.jsxs("div",{children:["Email: ",t?.email||"—"]}),e.jsxs("div",{children:["Notes: ",t?.notes||"—"]}),e.jsxs("div",{children:["Tags:"," ",t?.tags&&t.tags.length>0?t.tags.join(", "):"—"]})]})]})})]}):e.jsx(z,{title:"Select a branch",description:"Choose a branch to manage clients."})}export{ze as default};
