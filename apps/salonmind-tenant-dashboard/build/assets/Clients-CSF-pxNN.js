import{r as l,j as e,t as c}from"./index-DEsDXUSK.js";import{C as P,d as A,a as K,b as Q,e as W}from"./card-CSfxeEk0.js";import{D as k,a as E,b as D,c as M}from"./dialog-DM_WnBAe.js";import{I as h}from"./input-fORRFi0u.js";import{L as x}from"./label-CZBKjXX6.js";import{c as X,B as r}from"./SalonMindLogo-BdYlaItP.js";import{B as T}from"./ownerService-B2O02PeP.js";import{u as Y,E as L,a as Z,S as O,b as $,P as ee,C as se}from"./useDebouncedValue-zGanXLWo.js";import{u as ae,a as te}from"./useClients-BcmQR8O5.js";import{P as ne}from"./phone-CmvAFeMj.js";import{M as ie}from"./mail-DgoHqvrE.js";import{T as le}from"./trash-2-B2_TkTN0.js";import"./index-prrkowPK.js";import"./Dashboard-Bh94dQr3.js";import"./search-BXv_aqr2.js";const re=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],oe=X("tag",re),_={fullName:"",phoneNumber:"",email:"",notes:"",tags:[]};function we({activeBranchId:o}){const[z,d]=l.useState(!1),[F,j]=l.useState(!1),[f,I]=l.useState(""),[V,u]=l.useState(1),[n,i]=l.useState(_),[t,p]=l.useState(null),N=Y(f),H=8;l.useEffect(()=>{u(1)},[N,o]);const{data:v,isLoading:q}=ae({branchId:o,search:N,page:V,limit:H}),C=v?.items??[],m=v?.pagination,{create:b,update:y,remove:g}=te(o),w=b.isPending||y.isPending||g.isPending,S=()=>{p(null),i(_),d(!0)},R=s=>{p(s),i({fullName:s.fullName,phoneNumber:s.phoneNumber,email:s.email||"",notes:s.notes||"",tags:s.tags||[]}),d(!0)},U=s=>{p(s),j(!0)},B=async()=>{if(!n.fullName||!n.phoneNumber){c.error("Name and phone number are required");return}try{t?(await y.mutateAsync({id:t._id,data:n}),c.success("Client updated")):(await b.mutateAsync({...n,branchId:o||void 0}),c.success("Client created")),d(!1)}catch(s){c.error(s?.message||"Unable to save client")}},G=async s=>{try{await g.mutateAsync(s),c.success("Client deleted")}catch(a){c.error(a?.message||"Unable to delete client")}};return o?e.jsxs("div",{className:"space-y-6",children:[e.jsx(Z,{title:"Clients",description:"Manage salon clients and their contact information.",searchValue:f,onSearchChange:I,onCreate:S,createLabel:"Add Client",isCreateDisabled:!o}),q?e.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:Array.from({length:6}).map((s,a)=>e.jsx(P,{children:e.jsxs(A,{className:"space-y-3 py-6",children:[e.jsx(O,{className:"h-6 w-32"}),e.jsx(O,{className:"h-4 w-48"})]})},a))}):C.length===0?e.jsx(L,{title:"No clients yet",description:"Add clients as they complete onboarding.",actionLabel:"Add client",onAction:S}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:C.map(s=>e.jsxs(P,{children:[e.jsxs(K,{className:"flex flex-row items-center justify-between space-y-0",children:[e.jsx(Q,{children:s.fullName}),e.jsx(T,{children:s.status||"active"})]}),e.jsxs(A,{className:"space-y-3 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),s.phoneNumber]}),s.email&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),s.email]}),s.tags&&s.tags.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.tags.map(a=>e.jsx(T,{variant:"secondary",children:a},a))})]})]}),e.jsxs(W,{className:"flex items-center justify-end gap-2",children:[e.jsx(r,{size:"icon",variant:"ghost",onClick:()=>U(s),children:e.jsx($,{className:"h-4 w-4"})}),e.jsx(r,{size:"icon",variant:"ghost",onClick:()=>R(s),children:e.jsx(ee,{className:"h-4 w-4"})}),e.jsx(se,{title:"Delete client",description:"This action archives the client for this tenant.",onConfirm:()=>G(s._id),trigger:e.jsx(r,{size:"icon",variant:"ghost",children:e.jsx(le,{className:"h-4 w-4"})}),disabled:g.isPending})]})]},s._id))}),m&&e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[e.jsxs("div",{children:["Page ",m.page," of ",m.totalPages]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx(r,{variant:"outline",size:"sm",onClick:()=>u(s=>Math.max(s-1,1)),disabled:!m.hasPrev,children:"Previous"}),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>u(s=>s+1),disabled:!m.hasNext,children:"Next"})]})]}),e.jsx(k,{open:z,onOpenChange:d,children:e.jsxs(E,{className:"max-w-lg",children:[e.jsx(D,{children:e.jsx(M,{children:t?"Edit Client":"Add Client"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Full name"}),e.jsx(h,{value:n.fullName,onChange:s=>i(a=>({...a,fullName:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Phone number"}),e.jsx(h,{value:n.phoneNumber,onChange:s=>i(a=>({...a,phoneNumber:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Email"}),e.jsx(h,{type:"email",value:n.email,onChange:s=>i(a=>({...a,email:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Tags (comma separated)"}),e.jsx(h,{value:n.tags.join(", "),onChange:s=>i(a=>({...a,tags:s.target.value.split(",").map(J=>J.trim()).filter(Boolean)}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Notes"}),e.jsx(h,{value:n.notes,onChange:s=>i(a=>({...a,notes:s.target.value}))})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(r,{variant:"outline",onClick:()=>d(!1),disabled:w,children:"Cancel"}),e.jsx(r,{onClick:B,disabled:w,children:"Save"})]})]})}),e.jsx(k,{open:F,onOpenChange:j,children:e.jsxs(E,{children:[e.jsx(D,{children:e.jsx(M,{children:t?.fullName})}),e.jsxs("div",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsxs("div",{children:["Phone: ",t?.phoneNumber||"—"]}),e.jsxs("div",{children:["Email: ",t?.email||"—"]}),e.jsxs("div",{children:["Notes: ",t?.notes||"—"]}),e.jsxs("div",{children:["Tags:"," ",t?.tags&&t.tags.length>0?t.tags.join(", "):"—"]})]})]})})]}):e.jsx(L,{title:"Select a branch",description:"Choose a branch to manage clients."})}export{we as default};
