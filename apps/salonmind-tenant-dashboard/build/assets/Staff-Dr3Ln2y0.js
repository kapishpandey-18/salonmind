import{r as n,j as e,t as l}from"./index-DEsDXUSK.js";import{C as S,d as C,a as Y,b as Z,e as B}from"./card-CSfxeEk0.js";import{D as T,a as O,b as F,c as L}from"./dialog-DM_WnBAe.js";import{I as m}from"./input-fORRFi0u.js";import{L as f}from"./label-CZBKjXX6.js";import{B as c}from"./SalonMindLogo-BdYlaItP.js";import{B as ee}from"./ownerService-B2O02PeP.js";import{S as se}from"./switch-CBTHbT7a.js";import{u as ae,E as _,a as te,S as A,b as ie,P as ne,C as le}from"./useDebouncedValue-zGanXLWo.js";import{u as re,a as ce}from"./useStaff-DAHatu7M.js";import{P as oe}from"./phone-CmvAFeMj.js";import{T as de}from"./trash-2-B2_TkTN0.js";import"./index-prrkowPK.js";import"./Dashboard-Bh94dQr3.js";import"./search-BXv_aqr2.js";const z={name:"",role:"",email:"",phone:"",notes:"",isActive:!0};function we({activeBranchId:o}){const[V,h]=n.useState(!1),[I,b]=n.useState(!1),[w,H]=n.useState(""),[U,g]=n.useState(1),[t,r]=n.useState(z),[i,j]=n.useState(null),P=ae(w),q=8;n.useEffect(()=>{g(1)},[P,o]);const{data:E,isLoading:$}=re({branchId:o,search:P,page:U,limit:q}),d=E?.items??[],x=E?.pagination,{create:D,update:R,updateStatus:u,remove:p}=ce(o),k=D.isPending||R.isPending||u.isPending||p.isPending,M=()=>{j(null),r(z),h(!0)},G=s=>{j(s),r({name:s.name||"",role:s.role||"",email:s.email||"",phone:s.phone||"",notes:s.notes||"",isActive:s.isActive??s.status!=="off"}),h(!0)},J=s=>{j(s),b(!0)},K=async()=>{if(!t.name){l.error("Name is required");return}try{i?(await R.mutateAsync({id:i._id,data:t}),l.success("Staff updated")):(await D.mutateAsync({...t,branchId:o||void 0}),l.success("Staff created")),h(!1)}catch(s){l.error(s?.message||"Unable to save staff member")}},Q=async s=>{try{await p.mutateAsync(s),l.success("Staff removed")}catch(a){l.error(a?.message||"Unable to remove staff member")}},W=async(s,a)=>{try{await u.mutateAsync({id:s._id,isActive:a}),l.success(`Staff ${a?"enabled":"disabled"}`)}catch(N){l.error(N?.message||"Unable to update status")}},v=n.useMemo(()=>{const s=d.length,a=d.filter(y=>y.isActive!==!1).length,N=s>0?d.reduce((y,X)=>y+(Number(X.rating)||0),0)/s:0;return{total:s,active:a,avgRating:N.toFixed(1)}},[d]);return o?e.jsxs("div",{className:"space-y-6",children:[e.jsx(te,{title:"Staff Management",description:"Search, create, and manage staff for the selected branch.",searchValue:w,onSearchChange:H,onCreate:M,createLabel:"Add Staff",isCreateDisabled:!o}),e.jsx(S,{children:e.jsxs(C,{className:"grid gap-4 py-4 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Members"}),e.jsx("p",{className:"text-2xl font-semibold",children:v.total})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Active"}),e.jsx("p",{className:"text-2xl font-semibold",children:v.active})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Avg. Rating"}),e.jsx("p",{className:"text-2xl font-semibold",children:v.avgRating})]})]})}),$?e.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:Array.from({length:6}).map((s,a)=>e.jsx(S,{children:e.jsxs(C,{className:"space-y-3 py-6",children:[e.jsx(A,{className:"h-6 w-32"}),e.jsx(A,{className:"h-4 w-48"}),e.jsx(A,{className:"h-4 w-20"})]})},a))}):d.length===0?e.jsx(_,{title:"No staff yet",description:"Add your first team member to get started.",actionLabel:"Add staff",onAction:M}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:d.map(s=>e.jsxs(S,{children:[e.jsxs(Y,{className:"flex flex-row items-center justify-between space-y-0",children:[e.jsx(Z,{children:s.name}),e.jsx(ee,{variant:s.isActive?"default":"secondary",children:s.role||"Team"})]}),e.jsxs(C,{className:"space-y-3 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),s.phone||"—"]}),e.jsxs("div",{children:["Rating: ",s.rating??"—"]}),e.jsxs("div",{children:["Notes: ",s.notes||"—"]})]}),e.jsxs(B,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{checked:s.isActive!==!1,onCheckedChange:a=>W(s,a),disabled:u.isPending}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.isActive!==!1?"Active":"Disabled"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{size:"icon",variant:"ghost",onClick:()=>J(s),children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx(c,{size:"icon",variant:"ghost",onClick:()=>G(s),children:e.jsx(ne,{className:"h-4 w-4"})}),e.jsx(le,{title:"Remove staff",description:"This will hide the staff member from this branch.",onConfirm:()=>Q(s._id),trigger:e.jsx(c,{size:"icon",variant:"ghost",children:e.jsx(de,{className:"h-4 w-4"})}),disabled:p.isPending})]})]})]},s._id))}),x&&e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[e.jsxs("div",{children:["Page ",x.page," of ",x.totalPages]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx(c,{variant:"outline",size:"sm",onClick:()=>g(s=>Math.max(s-1,1)),disabled:!x.hasPrev,children:"Previous"}),e.jsx(c,{variant:"outline",size:"sm",onClick:()=>g(s=>s+1),disabled:!x.hasNext,children:"Next"})]})]}),e.jsx(T,{open:V,onOpenChange:h,children:e.jsxs(O,{className:"max-w-lg",children:[e.jsx(F,{children:e.jsx(L,{children:i?"Edit Staff":"Add Staff"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Name"}),e.jsx(m,{value:t.name,onChange:s=>r(a=>({...a,name:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Role"}),e.jsx(m,{value:t.role,onChange:s=>r(a=>({...a,role:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Email"}),e.jsx(m,{type:"email",value:t.email,onChange:s=>r(a=>({...a,email:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Phone"}),e.jsx(m,{value:t.phone,onChange:s=>r(a=>({...a,phone:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Notes"}),e.jsx(m,{value:t.notes,onChange:s=>r(a=>({...a,notes:s.target.value}))})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(c,{variant:"outline",onClick:()=>h(!1),disabled:k,children:"Cancel"}),e.jsx(c,{onClick:K,disabled:k,children:"Save"})]})]})}),e.jsx(T,{open:I,onOpenChange:b,children:e.jsxs(O,{children:[e.jsx(F,{children:e.jsx(L,{children:i?.name})}),e.jsxs("div",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsxs("div",{children:["Role: ",i?.role||"—"]}),e.jsxs("div",{children:["Email: ",i?.email||"—"]}),e.jsxs("div",{children:["Phone: ",i?.phone||"—"]}),e.jsxs("div",{children:["Notes: ",i?.notes||"—"]})]})]})})]}):e.jsx(_,{title:"Select a branch",description:"Choose a branch to manage its staff."})}export{we as default};
